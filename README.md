
# flux-infra-monitoring üìä

FLUX-INFRA-MONITORING —î —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—î–º –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤ –∑ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–º. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π, –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –¥–ª—è –≤–∞—à–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —Å–∏—Å—Ç–µ–º.

## –ù–∞–≤—ñ–≥–∞—Ü—ñ—è

- [flux-infra-monitoring üìä](#flux-infra-monitoring-)
  - [–ù–∞–≤—ñ–≥–∞—Ü—ñ—è](#–Ω–∞–≤—ñ–≥–∞—Ü—ñ—è)
  - [–û–≥–ª—è–¥ üëÄ](#–æ–≥–ª—è–¥-)
  - [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚öôÔ∏è](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Ç–∞-–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è-Ô∏è)
  - [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Fluentbit](#–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è-fluentbit)
- [–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–∞ –≤–∞—à–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ:](#—Å–ø–æ—á–∞—Ç–∫—É-–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ-git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π-–Ω–∞-–≤–∞—à–æ–º—É-–∫–ª–∞—Å—Ç–µ—Ä—ñ)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–µ–∫—É Prometheus](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Å—Ç–µ–∫—É-prometheus)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–µ–∫—É Loki](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Å—Ç–µ–∫—É-loki)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–Ω–µ–ª–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É Grafana –¥–ª—è Flux](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-–ø–∞–Ω–µ–ª–µ–π-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É-grafana-–¥–ª—è-flux)
- [–î–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è opentelemetry-operator —É –Ω–∞—è–≤–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ cert-manager –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –∑–∞–ø—É—Å—Ç—ñ—Ç—å](#–¥–ª—è-–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-opentelemetry-operator-—É-–Ω–∞—è–≤–Ω–æ–º—É-–∫–ª–∞—Å—Ç–µ—Ä—ñ-–ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è-—â–æ-cert-manager-–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ-—Ç–∞-–∑–∞–ø—É—Å—Ç—ñ—Ç—å)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è opentelemetry-operator](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-opentelemetry-operator)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Tempo](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-tempo)
- [–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ Grafana –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤:](#–≤–∏-–º–æ–∂–µ—Ç–µ-–æ—Ç—Ä–∏–º–∞—Ç–∏-–¥–æ—Å—Ç—É–ø-–¥–æ-grafana-–∑–∞-–¥–æ–ø–æ–º–æ–≥–æ—é-–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è-–ø–æ—Ä—Ç—ñ–≤)
  - [–î–æ—Å—Ç—É–ø –¥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤](#–¥–æ—Å—Ç—É–ø-–¥–æ-–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö-—Å–µ—Ä–≤—ñ—Å—ñ–≤)
  - [–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è](#–ø—Ä–∏–∫–ª–∞–¥-–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
  - [–î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏](#–¥–æ–ø–æ–º—ñ–∂–Ω—ñ-—Ä–µ—Å—É—Ä—Å–∏)
  - [DEMO](#demo)

## –û–≥–ª—è–¥ üëÄ

–£ —Ü—å–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Å—Ç–µ–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:
* Prometheus üóÇÔ∏è
* Open Telemetry üåê
* Grafana üìà
* Loki üìú
* Fluent-bit üí¨

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚öôÔ∏è

1. –°–∫–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –¥–æ –≤–∞—à–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

   ```bash
   git clone https://github.com/matvrus/flux-infra-monitoring.git
   cd k-monitoring
   ```

2. –ù–∞–π–ª–µ–≥—à–∏–π —Å–ø–æ—Å—ñ–± –∑–∞–ø—É—Å–∫—É - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `docker-compose`.
   
   ```bash
   docker-compose up -d
   ```
   –∞–±–æ –±–µ–∑ —Ñ–ª–∞–≥—É -d —â–æ–± –±–∞—á–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å
      ```bash
   docker-compose up 
   ```

3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏–π —Å–µ—Ä–≤—ñ—Å —Ç–∞ —Å–µ—Ä–≤—ñ—Å —Å–ø–æ–≤—ñ—â–µ–Ω—å.

## –†–æ–±–æ—Ç–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤ ‚öôÔ∏è

–ö–æ–∂–µ–Ω —Å–µ—Ä–≤—ñ—Å –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ –æ–∫—Ä–µ–º–æ–º—É –ø–æ—Ä—Ç—ñ:
* Grafana: http://localhost:3002
* OpenTelemetry: http://localhost:4317
* Prometheus: http://localhost:9090

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ —Å–µ—Ä–≤—ñ—Å—É Grafana —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –¥–æ –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Loki –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤ —Ç–∞ Fluent-bit –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∂—É—Ä–Ω–∞–ª—ñ–≤.

üöÄ –ü–æ—á–Ω—ñ—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –∑ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–º —Å–≤–æ—ó—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —Å–∏—Å—Ç–µ–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é K-Monitoring!
# –ü—Ä–æ—î–∫—Ç: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —É Kubernetes –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é K-Monitoring



# –°—Ç–µ–∫ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ —É dev-—Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –≤ Kubernetes –¥–ª—è –≤–ª–∞—Å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É. Fluentbit –∑–±–∏—Ä–∞—î —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É—î –ª–æ–≥–∏ –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –≤—Å—ñ—Ö –Ω–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä—É.

## –í–º—ñ—Å—Ç

- [flux-infra-monitoring üìä](#flux-infra-monitoring-)
  - [–ù–∞–≤—ñ–≥–∞—Ü—ñ—è](#–Ω–∞–≤—ñ–≥–∞—Ü—ñ—è)
  - [–û–≥–ª—è–¥ üëÄ](#–æ–≥–ª—è–¥-)
  - [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚öôÔ∏è](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Ç–∞-–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è-Ô∏è)
  - [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Fluentbit](#–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è-fluentbit)
- [–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–∞ –≤–∞—à–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ:](#—Å–ø–æ—á–∞—Ç–∫—É-–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ-git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π-–Ω–∞-–≤–∞—à–æ–º—É-–∫–ª–∞—Å—Ç–µ—Ä—ñ)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–µ–∫—É Prometheus](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Å—Ç–µ–∫—É-prometheus)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–µ–∫—É Loki](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Å—Ç–µ–∫—É-loki)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–Ω–µ–ª–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É Grafana –¥–ª—è Flux](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-–ø–∞–Ω–µ–ª–µ–π-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É-grafana-–¥–ª—è-flux)
- [–î–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è opentelemetry-operator —É –Ω–∞—è–≤–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ cert-manager –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –∑–∞–ø—É—Å—Ç—ñ—Ç—å](#–¥–ª—è-–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-opentelemetry-operator-—É-–Ω–∞—è–≤–Ω–æ–º—É-–∫–ª–∞—Å—Ç–µ—Ä—ñ-–ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è-—â–æ-cert-manager-–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ-—Ç–∞-–∑–∞–ø—É—Å—Ç—ñ—Ç—å)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è opentelemetry-operator](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-opentelemetry-operator)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Tempo](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-tempo)
- [–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ Grafana –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤:](#–≤–∏-–º–æ–∂–µ—Ç–µ-–æ—Ç—Ä–∏–º–∞—Ç–∏-–¥–æ—Å—Ç—É–ø-–¥–æ-grafana-–∑–∞-–¥–æ–ø–æ–º–æ–≥–æ—é-–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è-–ø–æ—Ä—Ç—ñ–≤)
  - [–î–æ—Å—Ç—É–ø –¥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤](#–¥–æ—Å—Ç—É–ø-–¥–æ-–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö-—Å–µ—Ä–≤—ñ—Å—ñ–≤)
  - [–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è](#–ø—Ä–∏–∫–ª–∞–¥-–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
  - [–î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏](#–¥–æ–ø–æ–º—ñ–∂–Ω—ñ-—Ä–µ—Å—É—Ä—Å–∏)
  - [DEMO](#demo)

## –û–≥–ª—è–¥

K-Monitoring - —Ü–µ —Å—Ç–µ–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, —è–∫–∏–π –≤–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:
- Prometheus: —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç–∞ –æ–ø–æ–≤—ñ—â–µ–Ω—å
- Open Telemetry: –Ω–∞–±—ñ—Ä –±—ñ–±–ª—ñ–æ—Ç–µ–∫ —Ç–∞ –∞–≥–µ–Ω—Ç—ñ–≤ –¥–ª—è –∑–±–æ—Ä—É –º–µ—Ç—Ä–∏–∫ —Ç–∞ —Ç—Ä–µ–π—Å—ñ–≤
- Grafana: –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö
- Loki: —Å–∏—Å—Ç–µ–º–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó —Ç–∞ –ø–æ—à—É–∫—É –∂—É—Ä–Ω–∞–ª—ñ–≤
- Fluentbit: —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–±–æ—Ä—É —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É –ª–æ–≥—ñ–≤

–£ —Ü—å–æ–º—É –ø—Ä–æ—î–∫—Ç—ñ –º–∏ –∑–æ—Å–µ—Ä–µ–¥–∏–º–æ—Å—è –Ω–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—ñ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ —Å—Ç–µ–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —É –≤–∞—à–æ–º—É Kubernetes-—Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –∞ —Ç–∞–∫–æ–∂ –Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ Fluentbit –¥–ª—è –∑–±–æ—Ä—É —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É –ª–æ–≥—ñ–≤ –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –≤—Å—ñ—Ö –Ω–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä—É.

## –í–∏–º–æ–≥–∏

–ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∞—à–µ dev-—Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞—Å—Ç—É–ø–Ω–∏–º –≤–∏–º–æ–≥–∞–º:
- Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ
- –î–æ—Å—Ç—É–ø –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `kubectl`
–†–æ–∑–≥–æ—Ä–Ω—ñ—Ç—å –∫–ª–∞—Å—Ç–µ—Ä —É –∑—Ä—É—á–Ω–∏–π –¥–ª—è –≤–∞—Å —Å–ø–∞—Å—ñ–±. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [k3d](https://k3d.io/).
–£ –¥–∞–Ω–æ–º—É –∫–µ–π—Å—ñ —è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ TERRAFORM —Ä–∞–∑–æ–º –∑ KIND –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä—É.

–í–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑–≥–æ–Ω—É—Ç–∏ —Å—Ç–µ–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é docker-compose, –∞–ª–µ –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤—Ä—É—á–Ω—É –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑—ñ —Å—Ç–µ–∫–æ–º –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É. –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ docker-compose, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:
- –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `docker` —Ç–∞ `docker-compose` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑—ñ —Å—Ç–µ–∫–æ–º –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
- —Å–∫–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π `flux-infra-monitoring`
- –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `docker-compose up -d` –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Å—Ç–µ–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

## –ö—Ä–æ–∫–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

1. –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π flux-infra-monitoring:

   ```bash
   git clone https://github.com/matvrus/flux-infra-monitoring.git
   cd flux-infra-monitoring
   flux reconcile kustomization monitoring --with-source
   flux get all -A
   ```
## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Fluentbit

Fluentbit - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–±–æ—Ä—É —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É –ª–æ–≥—ñ–≤. –©–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Fluentbit –¥–ª—è –∑–±–æ—Ä—É –ª–æ–≥—ñ–≤ –≤–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –≤—Å—ñ—Ö –Ω–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä—É, –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤:

1. –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª `fluentbit-configmap.yaml` —Ç–∞ –∑–∞–º—ñ–Ω—ñ—Ç—å `<your_project_logs_path>` –Ω–∞ —à–ª—è—Ö –¥–æ –ª–æ–≥—ñ–≤ –≤–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É.

2. –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª –¥–æ –≤–∞—à–æ–≥–æ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞:

# –°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–∞ –≤–∞—à–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ:
flux create source git flux-infra-monitoring \
  --interval=30m \
  --url=https://github.com/matvrus/flux-infra-monitoring \
  --branch=main

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–µ–∫—É Prometheus
flux create kustomization kube-prometheus-stack \
  --interval=1h \
  --prune \
  --source=flux-infra-monitoring \
  --path="./monitoring/kube-prometheus-stack" \
  --health-check-timeout=5m \
  --wait

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–µ–∫—É Loki
flux create kustomization loki-stack \
  --depends-on=kube-prometheus-stack \
  --interval=1h \
  --prune \
  --source=flux-infra-monitoring \
  --path="./monitoring/loki-stack" \
  --health-check-timeout=5m \
  --wait

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–Ω–µ–ª–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É Grafana –¥–ª—è Flux
flux create kustomization monitoring-config \
  --depends-on=kube-prometheus-stack \
  --interval=1h \
  --prune=true \
  --source=flux-infra-monitoring \
  --path="./monitoring/monitoring-config" \
  --health-check-timeout=1m \
  --wait

# –î–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è opentelemetry-operator —É –Ω–∞—è–≤–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ cert-manager –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –∑–∞–ø—É—Å—Ç—ñ—Ç—å
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.12.2/cert-manager.yaml

flux create kustomization cert-manager \
  --interval=1h \
  --retry-interval=1m \
  --prune=true \
  --source=flux-infra-monitoring \
  --path="./monitoring/cert-manager" \
  --health-check-timeout=1m \
  --wait

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è opentelemetry-operator
flux create source helm open-telemetry \
  --url=https://open-telemetry.github.io/opentelemetry-helm-charts \
  --interval=10m \
  --namespace=flux-system

flux create kustomization open-telemetry \
  --interval=1h \
  --prune=true \
  --source=flux-infra-monitoring \
  --path="./monitoring/open-telemetry" \
  --health-check-timeout=1m \
  --wait

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Tempo
flux create source helm tempo \
  --url=https://grafana.github.io/tempo-helm-chart \
  --interval=10m \
  --namespace=flux-system

flux create kustomization tempo \
  --interval=1h \
  --prune=true \
  --source=flux-infra-monitoring \
  --path="./monitoring/tempo" \
  --health-check-timeout=1m \
  --wait

# –í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ Grafana –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤:
kubectl -n monitoring port-forward svc/kube-prometheus-stack-grafana 3000:80
   ```

3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ Fluentbit —É—Å–ø—ñ—à–Ω–æ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ:

   ```bash
   kubectl get pods --namespace=k-monitoring
   ```

## –î–æ—Å—Ç—É–ø –¥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤

–ü—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Å—Ç–µ–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤:

- Grafana: http://localhost:3002
- Prometheus: http://localhost:9090
- Loki: http://localhost:3100

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–µ–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ—á–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–≤–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É. –ó–±–∏—Ä–∞–Ω–Ω—è —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –º–µ—Ç—Ä–∏–∫, —Ç—Ä–µ–π—Å—ñ–≤ —Ç–∞ –ª–æ–≥—ñ–≤ –¥–æ–ø–æ–º–æ–∂—É—Ç—å –≤–∞–º –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ –≤–¥–æ—Å–∫–æ–Ω–∞–ª—é–≤–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç.

## –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏

–î–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏:

- [Prometheus –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://prometheus.io/docs/)
- [Open Telemetry –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://opentelemetry.io/docs/)
- [Grafana –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://grafana.com/docs/)
- [Loki –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://grafana.com/oss/loki/)
- [Fluentbit –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://fluentbit.io/documentation/)


## DEMO


| Example 1 | Example 2 | Example 3 | Example 4 |
|-----------|-----------|-----------|-----------|
| ![Example 1](data/01.png) | ![Example 2](data/02.png) | ![Example 3](data/03.png) | ![Example 4](data/04.png) |

| Example 5 | Example 6 | Example 7 | Example 8 |
|-----------|-----------|-----------|-----------|
| ![Example 5](data/05.png) | ![Example 6](data/06.png) | ![Example 7](data/07.png) | ![Example 8](data/08.png) |

| Example 9 | Example 10 | Example 11 | Example 12 |
|-----------|------------|------------|------------|
| ![Example 9](data/09.png) | ![Example 10](data/10.png) | ![Example 11](data/11.png) | ![Example 12](data/12.png) |

| Example 13 | Example 14 | Example 15 | Example 16 |
|------------|------------|------------|------------|
| ![Example 13](data/13.png) | ![Example 14](data/14.png) | ![Example 15](data/15.png) | ![Example 16](data/16.png) |

| Example 17 | Example 18 |
|------------|------------|
| ![Example 17](data/17.png) | ![Example 18](data/18.png) |


–î–∏–≤—ñ—Ç—å—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–µ –≤—ñ–¥–µ–æ –Ω–∞ YouTube, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —Å—Ç–µ–∫ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤ –¥—ñ—ó: ![[Example 19](https://youtu.be/Gi-2FskO0jk)](data/19.png)[–î–µ–º–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ–≥–æ —Å—Ç–µ–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É](https://youtu.be/Gi-2FskO0jk).
